id: migrate_cuidarnos
label: 'Migrate Cuidarnos from the xml file'

source:
  plugin: url
  data_fetcher_plugin: file
  data_parser_plugin: simple_xml
  urls:
    - 'modules/custom/royal_migrate/sources/cuidarnos.wordpress.2020-06-03.xml'
  # An xpath-like selector corresponding to the items to be imported.
  item_selector: /rss/channel/item[wp:post_type="post"]

  ids:
    title:
      type: string

  fields:
    -
      name: field_wp_post_id
      label: 'Common title'
      selector: wp:post_id

    -
      name: title
      label: 'Common title'
      selector: title

    -
      name: content
      label: 'Common content'
      selector: excerpt:encoded

    -
      name: field_subtitle
      label: 'Common field_subtitle'
      selector: content:encoded

    -
      name: field_tags
      label: 'Common Tags'
      selector: category[@domain="post_tag"]

    -
      name: field_category
      label: 'Common Tags'
      selector: category[@domain="category"]

    -
      name: wp_thumbnail_id
      label: 'Main Image'
      selector: wp:postmeta[wp:meta_key='_thumbnail_id']/wp:meta_value

    -
      name: slug
      label: "Machine name"
      selector: wp:post_name

    -
      name: columna_1_bloque1
      label: "columna_1_bloque1"
      selector: wp:postmeta[wp:meta_key='columna_1_bloque1']/wp:meta_value

    -
      name: columna_2_bloque1
      label: "columna_2_bloque1"
      selector: wp:postmeta[wp:meta_key='columna_2_bloque1']/wp:meta_value

    -
      name: columna_1_bloque2
      label: "columna_1_bloque2"
      selector: wp:postmeta[wp:meta_key='columna_1_bloque2']/wp:meta_value

    -
      name: columna_2_bloque2
      label: "columna_2_bloque2"
      selector: wp:postmeta[wp:meta_key='columna_2_bloque2']/wp:meta_value



process:

  field_wp_post_id: field_wp_post_id
  title: title
  field_subtitle: field_subtitle
  body:
    plugin: cuidarnos_manage_content
    field: body
  field_bloque_2:
      -
        plugin: concat
        source:
          - columna_1_bloque1
          - columna_2_bloque1
          - columna_1_bloque2
          - columna_2_bloque2
      -
        plugin: cuidarnos_manage_content
        field: field_bloque_2

  field_wp_thumbnail_id: wp_thumbnail_id
  field_meta_labels:
    plugin: entity_generate
    source: field_tags
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: tags
    value_key: name
  field_category:
    plugin: entity_generate
    source: field_category
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: category
    value_key: name

destination:
  plugin: entity:node
  default_bundle: magazine

